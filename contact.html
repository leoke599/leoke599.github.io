<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Contact Us | NASA HUNCH Project</title>
  <link rel="stylesheet" href="/style.css" />
</head>
<body class="bg-gray-50 text-gray-900">
  <main class="max-w-md mx-auto mt-20 p-6 bg-white shadow-lg rounded-2xl">
    <h1 class="text-2xl font-bold mb-4 text-center">Contact Us</h1>

    <form id="contact" action="/api/contact" method="POST" class="flex flex-col gap-4">
      <label class="flex flex-col">
        Name:
        <input type="text" name="name" required maxlength="80" class="border p-2 rounded-md" autocomplete="name" />
      </label>

      <label class="flex flex-col">
        Email:
        <input type="email" name="email" required maxlength="120" class="border p-2 rounded-md" autocomplete="email" />
      </label>

      <label class="flex flex-col">
        Message:
        <textarea name="message" required maxlength="5000" rows="5" class="border p-2 rounded-md"></textarea>
      </label>

      <!-- üß† Cloudflare Turnstile widget -->
      <div
        class="cf-turnstile self-center"
        data-sitekey="0x4AAAAAAB86w4VDNVovRyC5"
        data-appearance="always"
        data-callback="tsOk"
        data-error-callback="tsErr"
        data-timeout-callback="tsErr">
      </div>

      <!-- Failsafe warning -->
      <div id="captcha-warning" style="display:none; color:red; margin-top:1em; text-align:center;">
        ‚ö†Ô∏è CAPTCHA failed to load. Try another network or browser.
      </div>

      <button id="sendBtn" type="submit"
        class="bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition disabled:opacity-50">
        Send Message
      </button>
    </form>
  </main>

  <!-- ‚öôÔ∏è Cloudflare Turnstile script -->
  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>

  <noscript>
    <p style="color:red; text-align:center; margin-top:1em;">
      ‚ö†Ô∏è Please enable JavaScript to view the CAPTCHA and submit this form.
    </p>
  </noscript>

  <script>
    // Disable the button during submission to prevent double sends
    const form = document.getElementById('contact');
    const btn = document.getElementById('sendBtn');
    form.addEventListener('submit', () => {
      btn.disabled = true;
      btn.textContent = 'Sending‚Ä¶';
    });

    // Turnstile callbacks
    window.tsOk = function () {
      const warn = document.getElementById('captcha-warning');
      if (warn) warn.style.display = 'none';
    };
    window.tsErr = function () {
      const warn = document.getElementById('captcha-warning');
      if (warn) warn.style.display = 'block';
    };

    // Final fallback if Turnstile never loads at all (blocked network)
    window.addEventListener('load', () => {
      setTimeout(() => {
        if (!window.turnstile) {
          const warn = document.getElementById('captcha-warning');
          if (warn) warn.style.display = 'block';
        }
      }, 6000);
    });
  </script>
</body>
</html>
